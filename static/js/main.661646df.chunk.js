(this["webpackJsonpreact-todo"]=this["webpackJsonpreact-todo"]||[]).push([[0],{23:function(e,t,n){},28:function(e,t,n){"use strict";n.r(t);var c=n(1),a=n.n(c),r=n(6),o=n.n(r),s=(n(21),n(22),n(23),n(3)),i=n.n(s),u=n(7),l=n(5),d=n(2),f=n(4),j=n.n(f),b="https://mate.academy/students-api";function p(e){return new Promise((function(t){setTimeout(t,e)}))}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c={method:t};return n&&(c.body=JSON.stringify(n),c.headers={"Content-Type":"application/json; charset=UTF-8"}),p(300).then((function(){return fetch(b+e,c)})).then((function(e){if(!e.ok)throw new Error;return e.json()}))}var h,O=function(e){return m(e)},v=function(e,t){return m(e,"POST",t)},x=function(e,t){return m(e,"PATCH",t)},g=function(e){return m(e,"DELETE")},y=function(e,t){return x("/todos/".concat(e),t)},N=function(e){return g("/todos/".concat(e))},k=function(){var e=Object(l.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O("/users?email=".concat(t));case 2:return n=e.sent,e.abrupt("return",n[0]||null);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=function(){var e=Object(l.a)(i.a.mark((function e(t){var n,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.email,c=t.name,e.abrupt("return",v("/users",{email:n,name:c}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=n(0),w=function(e){var t=e.onLogin,n=Object(c.useState)(""),a=Object(d.a)(n,2),r=a[0],o=a[1],s=Object(c.useState)(""),u=Object(d.a)(s,2),f=u[0],b=u[1],p=Object(c.useState)(!1),m=Object(d.a)(p,2),h=m[0],O=m[1],v=Object(c.useState)(!1),x=Object(d.a)(v,2),g=x[0],y=x[1],N=Object(c.useState)(""),w=Object(d.a)(N,2),T=w[0],_=w[1],S=function(e){localStorage.setItem("user",JSON.stringify(e)),t(e)};Object(c.useEffect)((function(){var e=localStorage.getItem("user");if(e)try{var n=JSON.parse(e);t(n)}catch(c){}}),[]);var L=function(){var e=Object(l.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k(r);case 2:(t=e.sent)?S(t):O(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){var e=Object(l.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),_(""),y(!0),e.prev=3,!h){e.next=9;break}return e.next=7,C({name:f,email:r}).then(S);case 7:e.next=11;break;case 9:return e.next=11,L();case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),_("Something went wrtong");case 16:return e.prev=16,y(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[3,13,16,19]])})));return function(t){return e.apply(this,arguments)}}();return Object(E.jsxs)("form",{onSubmit:A,className:"box mt-5",children:[Object(E.jsx)("h1",{className:"title is-3",children:h?"You need to register":"Log in to open todos"}),Object(E.jsxs)("div",{className:"field",children:[Object(E.jsx)("label",{className:"label",htmlFor:"user-email",children:"Email"}),Object(E.jsxs)("div",{className:j()("control has-icons-left",{"is-loading":g}),children:[Object(E.jsx)("input",{type:"email",id:"user-email",className:j()("input",{"is-danger":!h&&T}),placeholder:"Enter your email",disabled:g||h,value:r,required:!0,onChange:function(e){return o(e.target.value)}}),Object(E.jsx)("span",{className:"icon is-small is-left",children:Object(E.jsx)("i",{className:"fas fa-envelope"})})]}),!h&&T&&Object(E.jsx)("p",{className:"help is-danger",children:T})]}),h&&Object(E.jsxs)("div",{className:"field",children:[Object(E.jsx)("label",{className:"label",htmlFor:"user-name",children:"Your Name"}),Object(E.jsxs)("div",{className:j()("control has-icons-left",{"is-loading":g}),children:[Object(E.jsx)("input",{type:"text",id:"user-name",className:j()("input",{"is-danger":h&&T}),placeholder:"Enter your name",required:!0,minLength:4,disabled:g,value:f,onChange:function(e){return b(e.target.value)}}),Object(E.jsx)("span",{className:"icon is-small is-left",children:Object(E.jsx)("i",{className:"fas fa-user"})})]}),h&&T&&Object(E.jsx)("p",{className:"help is-danger",children:T})]}),Object(E.jsx)("div",{className:"field",children:Object(E.jsx)("button",{type:"submit",className:j()("button is-primary",{"is-loading":g}),children:h?"Register":"Login"})})]})},T=a.a.createContext(null),_=function(e){var t=e.children,n=Object(c.useState)(null),a=Object(d.a)(n,2),r=a[0],o=a[1];return r?Object(E.jsx)(T.Provider,{value:r,children:t}):Object(E.jsx)(w,{onLogin:o})};!function(e){e.ALL="all",e.ACTIVE="active",e.COMPLETED="completed"}(h||(h={}));var S=a.a.memo((function(e){var t=e.filterStatus,n=e.onFilter,c=function(e){t!==e&&n(e)};return Object(E.jsxs)("nav",{className:"filter","data-cy":"Filter",children:[Object(E.jsx)("a",{"data-cy":"FilterLinkAll",href:"#/",className:j()("filter__link",{selected:"all"===t}),onClick:function(){c(h.ALL)},children:"All"}),Object(E.jsx)("a",{"data-cy":"FilterLinkActive",href:"#/active",className:j()("filter__link",{selected:"active"===t}),onClick:function(){c(h.ACTIVE)},children:"Active"}),Object(E.jsx)("a",{"data-cy":"FilterLinkCompleted",href:"#/completed",className:j()("filter__link",{selected:"completed"===t}),onClick:function(){c(h.COMPLETED)},children:"Completed"})]})})),L=n(31),A=n(30),F=function(e){var t=e.todos,n=e.isProcessing,a=e.onStatusChange,r=e.onTitleChange,o=e.onDeleteTodo,s=Object(c.useRef)(null),i=Object(c.useState)(null),u=Object(d.a)(i,2),l=u[0],f=u[1],b=Object(c.useState)(""),p=Object(d.a)(b,2),m=p[0],h=p[1],O=function(e){h(e.target.value)},v=function(e,t){f(null),""===m?o(e):m!==t&&r(e,m)},x=function(e){"Escape"===e.key&&f(null)};return Object(c.useEffect)((function(){s.current&&s.current.focus()}),[l]),Object(E.jsx)(L.a,{children:t.map((function(e){var t=e.id,c=e.title,r=e.completed;return Object(E.jsx)(A.a,{timeout:300,classNames:j()({item:0!==t},{"temp-item":0===t}),children:Object(E.jsxs)("div",{"data-cy":"Todo",className:j()("todo",{completed:r}),children:[Object(E.jsx)("label",{className:"todo__status-label",children:Object(E.jsx)("input",{"data-cy":"TodoStatus",type:"checkbox",className:"todo__status",checked:r,onChange:function(){return a(t)}})}),t===l?Object(E.jsx)("form",{onSubmit:function(e){e.preventDefault(),v(t,c)},children:Object(E.jsx)("input",{"data-cy":"TodoTitleField",type:"text",className:"todo__title-field",placeholder:"Empty todo will be deleted",value:m,onChange:O,onBlur:function(){return v(t,c)},onKeyDown:x,ref:s})}):Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)("span",{"data-cy":"TodoTitle",className:"todo__title",onDoubleClick:function(){return function(e,t){f(e),h(t)}(t,c)},children:c}),Object(E.jsx)("button",{type:"button",className:"todo__remove","data-cy":"TodoDeleteButton",onClick:function(){o(t)},children:"\xd7"})]}),Object(E.jsxs)("div",{"data-cy":"TodoLoader",className:j()("modal","overlay",{"is-active":n.includes(t)}),children:[Object(E.jsx)("div",{className:"modal-background has-background-white-ter"}),Object(E.jsx)("div",{className:"loader"})]})]})},t)}))})},D=function(e){var t=e.error,n=e.onCloseError;return Object(E.jsxs)("div",{"data-cy":"ErrorNotification",className:j()("notification","is-danger","is-light","has-text-weight-normal",{hidden:!t}),children:[Object(E.jsx)("button",{"data-cy":"HideErrorButton",type:"button",className:"delete",onClick:function(){n()}}),t]})},I=function(e,t){return e.find((function(e){return e.id===t}))||null},P=function(e,t){switch(t){case h.ALL:return e;case h.ACTIVE:return e.filter((function(e){return!e.completed}));case h.COMPLETED:return e.filter((function(e){return e.completed}));default:throw new Error("Error: Filter todos")}},B=function(){var e=Object(c.useContext)(T),t=Object(c.useRef)(null),n=Object(c.useState)([]),a=Object(d.a)(n,2),r=a[0],o=a[1],s=Object(c.useState)(h.ALL),f=Object(d.a)(s,2),b=f[0],p=f[1],m=Object(c.useState)(""),x=Object(d.a)(m,2),g=x[0],k=x[1],C=Object(c.useState)(!1),w=Object(d.a)(C,2),_=w[0],L=w[1],A=Object(c.useState)([0]),B=Object(d.a)(A,2),J=B[0],M=B[1],U=Object(c.useState)(""),V=Object(d.a)(U,2),R=V[0],q=V[1],H=Object(c.useState)(0),Y=Object(d.a)(H,2),G=Y[0],K=Y[1],W=Object(c.useMemo)((function(){return P(r,b)}),[r,b]),z=Object(c.useMemo)((function(){return P(r,h.ACTIVE).length}),[r]);function Q(e){M((function(t){return t.filter((function(t){return t!==e}))}))}function X(e){o((function(t){return t.filter((function(t){return t.id!==e}))}))}var Z=function(e){q(e),K((function(e){return e+1}))},$=function(){var t=Object(l.a)(i.a.mark((function t(n){var c,a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),q(""),g.replace(/\s/g,"")){t.next=6;break}return Z("Title can't be empty"),k(""),t.abrupt("return");case 6:if(!e){t.next=25;break}return L(!0),c={id:0,userId:e.id,title:g,completed:!1},o((function(e){return[].concat(Object(u.a)(e),[c])})),t.prev=10,t.next=13,v("/todos",c);case 13:a=t.sent,o((function(e){return[].concat(Object(u.a)(e),[a])})),k(""),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(10),Z("Unable to add a todo");case 21:return t.prev=21,X(0),L(!1),t.finish(21);case 25:case"end":return t.stop()}}),t,null,[[10,18,21,25]])})));return function(e){return t.apply(this,arguments)}}(),ee=function(){var e=Object(l.a)(i.a.mark((function e(t,n){var c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(q(""),M((function(e){return[].concat(Object(u.a)(e),[t])})),e.prev=2,!(c=I(r,t))){e.next=8;break}return e.next=7,y(t,n?{title:n}:{completed:!c.completed});case 7:o((function(e){return n?(c.title=n,Object(u.a)(e)):(c.completed=!c.completed,Object(u.a)(e))}));case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),Z("Unable to update a todo");case 13:return e.prev=13,Q(t),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[2,10,13,16]])})));return function(t,n){return e.apply(this,arguments)}}(),te=function(){var e=Object(l.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return q(""),M((function(e){return[].concat(Object(u.a)(e),[t])})),e.prev=2,e.next=5,N(t);case 5:X(t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),Z("Unable to delete a todo");case 11:return e.prev=11,Q(t),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[2,8,11,14]])})));return function(t){return e.apply(this,arguments)}}();return Object(c.useEffect)((function(){(function(){var t=Object(l.a)(i.a.mark((function t(){var n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=11;break}return t.prev=1,t.next=4,c=e.id,O("/todos?userId=".concat(c));case 4:n=t.sent,o(n),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),Z("Unable to load a todos");case 11:case"end":return t.stop()}var c}),t,null,[[1,8]])})));return function(){return t.apply(this,arguments)}})()()}),[]),Object(c.useEffect)((function(){t.current&&t.current.focus()}),[_]),Object(c.useEffect)((function(){var e=setTimeout((function(){return q("")}),3e3);return function(){clearTimeout(e)}}),[G]),Object(E.jsxs)("div",{className:"todoapp",children:[Object(E.jsx)("h1",{className:"todoapp__title",children:"todos"}),Object(E.jsxs)("div",{className:"todoapp__content",children:[Object(E.jsxs)("header",{className:"todoapp__header",children:[r.length>0&&Object(E.jsx)("button",{"data-cy":"ToggleAllButton",type:"button",className:j()("todoapp__toggle-all",{active:0===z}),onClick:function(){r.forEach((function(e){0!==z&&e.completed||ee(e.id)}))}}),Object(E.jsx)("form",{onSubmit:$,children:Object(E.jsx)("input",{"data-cy":"NewTodoField",type:"text",ref:t,className:"todoapp__new-todo",placeholder:"What needs to be done?",value:g,onChange:function(e){return k(e.target.value)},disabled:_})})]}),Object(E.jsx)("section",{className:"todoapp__main","data-cy":"TodoList",children:Object(E.jsx)(F,{todos:W,isProcessing:J,onStatusChange:ee,onTitleChange:ee,onDeleteTodo:te})}),r.length>0&&Object(E.jsxs)("footer",{className:"todoapp__footer","data-cy":"Footer",children:[Object(E.jsx)("span",{className:"todo-count","data-cy":"todosCounter",children:"".concat(z," items left")}),Object(E.jsx)(S,{filterStatus:b,onFilter:p}),Object(E.jsx)("button",{"data-cy":"ClearCompletedButton",type:"button",className:"todoapp__clear-completed",onClick:function(){r.forEach((function(e){e.completed&&te(e.id)}))},disabled:r.length-z===0,children:"Clear completed"})]})]}),Object(E.jsx)(D,{error:R,onCloseError:function(){q("")}})]})};o.a.render(Object(E.jsx)(_,{children:Object(E.jsx)(B,{})}),document.getElementById("root"))}},[[28,1,2]]]);
//# sourceMappingURL=main.661646df.chunk.js.map